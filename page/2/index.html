<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>万事屋</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta property="og:type" content="website">
<meta property="og:title" content="万事屋">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="万事屋">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="万事屋">
    

    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">万事屋</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">主页</a>
                
                    <a class="main-nav-link" href="/archives">归档</a>
                
                    <a class="main-nav-link" href="/categories">分类</a>
                
                    <a class="main-nav-link" href="/tags">标签</a>
                
                    <a class="main-nav-link" href="/about">关于</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/me.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">主页</a></td>
                
                    <td><a class="main-nav-link" href="/archives">归档</a></td>
                
                    <td><a class="main-nav-link" href="/categories">分类</a></td>
                
                    <td><a class="main-nav-link" href="/tags">标签</a></td>
                
                    <td><a class="main-nav-link" href="/about">关于</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/me.png" />
            <h2 id="name">sapphireHL</h2>
            <h3 id="title">Programer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Nanjing, China</span>
            <a id="follow" target="_blank" href="https://github.com/sapphireHL">关注我</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                26
                <span>文章</span>
            </div>
            <div class="article-info-block">
                6
                <span>标签</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/sapphireHL" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-factory" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/05/08/factory/">设计模式之工厂模式</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/05/08/factory/">
            <time datetime="2018-05-08T23:43:43.000Z" itemprop="datePublished">2018-05-08</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/设计模式/">设计模式</a>, <a class="tag-link" href="/tags/读书笔记/">读书笔记</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><ul>
<li>工厂方法模式：定义了一个创建对象的接口，但由子类决定要实例化的类是哪一个，将类的实例化推迟到子类。</li>
<li>抽象工厂模式：提供一个接口，用于创建相关或依赖对象的家族，而不需要明确指定具体类。</li>
</ul>
<h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="https://s1.ax1x.com/2018/05/08/Cah9i9.jpg" alt="Cah9i9.jpg"></p>
<h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><p>工厂方法<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pizza</span> &#123;</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="built_in">string</span> name;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="built_in">string</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NYCheesePizza</span> :</span><span class="keyword">public</span> Pizza &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	NYCheesePizza()&#123;</span><br><span class="line">		name = <span class="string">"NYCheesePizza"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChicagoCheesePizza</span> :</span><span class="keyword">public</span> Pizza &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	ChicagoCheesePizza() &#123;</span><br><span class="line">		name = <span class="string">"ChicagoCheesePizza"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PizzaStore</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">orderPizza</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Pizza* pizza = createPizza();</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"order "</span> &lt;&lt; pizza-&gt;getName() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> Pizza* <span class="title">createPizza</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NYPizzaStore</span> :</span><span class="keyword">public</span> PizzaStore &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">Pizza* <span class="title">createPizza</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Pizza* pizza = <span class="keyword">new</span> NYCheesePizza();</span><br><span class="line">		<span class="keyword">return</span> pizza;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChicagoPizzaStore</span> :</span><span class="keyword">public</span> PizzaStore &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">Pizza* <span class="title">createPizza</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Pizza* pizza = <span class="keyword">new</span> ChicagoCheesePizza();</span><br><span class="line">		<span class="keyword">return</span> pizza;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>抽象工厂可以看成是有多个工厂方法的一个工厂，生产一系列产品。</p>
<h3 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h3><p>封装对象的创建，将对象实例化交给子类来决定，在基类中声明一个创建的接口，由子类来实现它。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2018/05/08/factory/" data-id="cjgybwwb50008q6jxjcymxhq1" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-decorator" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/05/07/decorator/">设计模式之装饰者模式</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/05/07/decorator/">
            <time datetime="2018-05-07T14:00:07.000Z" itemprop="datePublished">2018-05-07</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/设计模式/">设计模式</a>, <a class="tag-link" href="/tags/读书笔记/">读书笔记</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="装饰者模式"><a href="#装饰者模式" class="headerlink" title="装饰者模式"></a>装饰者模式</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>动态地将责任附加到对象上。若要扩展功能，装饰者提供了比继承更有弹性的替代方案。</p>
<h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="https://s1.ax1x.com/2018/05/07/CasrL9.jpg" alt="CasrL9.jpg"></p>
<h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Beverage</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="built_in">string</span> <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> description;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">double</span> <span class="title">cost</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="built_in">string</span> description;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CondimentDecorator</span> :</span><span class="keyword">public</span> Beverage &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="built_in">string</span> <span class="title">getDescription</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Espresso</span> :</span><span class="keyword">public</span> Beverage &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	Espresso()&#123;</span><br><span class="line">		description = <span class="string">"Espresso"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">cost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1.99</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HouseBlend</span> :</span><span class="keyword">public</span> Beverage &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	HouseBlend()&#123;</span><br><span class="line">		description = <span class="string">"HouseBlend"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">cost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0.89</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mocha</span> :</span><span class="keyword">public</span> CondimentDecorator &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	Beverage* beverage;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	Mocha(Beverage* b) :beverage(b) &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="built_in">string</span> <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> beverage-&gt;getDescription() + <span class="string">",Mocha"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">cost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0.2</span> + beverage-&gt;cost();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Whip</span> :</span><span class="keyword">public</span> CondimentDecorator &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	Beverage* beverage;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	Whip(Beverage* b) :beverage(b) &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="built_in">string</span> <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> beverage-&gt;getDescription() + <span class="string">",Whip"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">cost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0.5</span> + beverage-&gt;cost();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h3><p>使用接口，装饰者和被装饰者继承同一个接口，装饰者拥有一个被装饰者，当调用方法时，装饰者先执行自己新增的部分，再调用被装饰者的方法，这样就实现了扩展功能。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2018/05/07/decorator/" data-id="cjgybwway0005q6jxrzc00614" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-observer" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/05/07/observer/">设计模式之观察者模式</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/05/07/observer/">
            <time datetime="2018-05-07T13:59:07.000Z" itemprop="datePublished">2018-05-07</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/设计模式/">设计模式</a>, <a class="tag-link" href="/tags/读书笔记/">读书笔记</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>定义了对象之间的一对多依赖，这样一来，当一个对象改变状态时，它的所有依赖都会收到通知并自动更新。</p>
<h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="https://s1.ax1x.com/2018/05/07/Cart3D.jpg" alt=""></p>
<h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//被观察者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="built_in">vector</span>&lt;Observer*&gt; observers;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(Observer* o)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">removeObserver</span><span class="params">(Observer* o)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteSubject</span> :</span> <span class="keyword">public</span> Subject&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(Observer* o)</span></span>&#123;</span><br><span class="line">		observers.push_back(o);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">removeObserver</span><span class="params">(Observer* o)</span></span>&#123;</span><br><span class="line">		<span class="keyword">auto</span> it = observers.find(o);</span><br><span class="line">		<span class="keyword">if</span>(it != observers.end())&#123;</span><br><span class="line">			observers.erase(it);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; observers.size(); ++i)&#123;</span><br><span class="line">			observers[i]-&gt;update();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//状态已改变</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">stateChanged</span><span class="params">()</span></span>&#123;</span><br><span class="line">		notifyObservers();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//观察者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserver</span> :</span> <span class="keyword">public</span> Observer&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	Subject* data;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	ConcreteObserver(Subject* subjectData) : data(subjectData)&#123;</span><br><span class="line">		data-&gt;registerObserver(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"Get new data!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h3><p>用户关注感兴趣的事件，当事件发生变化时，会自动收到通知从而改变自己的状态，而不是主动向事件询问状态。可以实现按键监听。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2018/05/07/observer/" data-id="cjgybwwbx000mq6jx4co6q873" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-strategy" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/05/07/strategy/">设计模式之策略模式</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/05/07/strategy/">
            <time datetime="2018-05-07T13:54:06.000Z" itemprop="datePublished">2018-05-07</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/设计模式/">设计模式</a>, <a class="tag-link" href="/tags/读书笔记/">读书笔记</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>策略模式封装了算法族，分别封装起来，让它们之间可以互换，此模式让算法变化独立于使用算法的客户。</p>
<h3 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h3><p><img src="https://s1.ax1x.com/2018/05/07/CaD4fO.jpg" alt=""></p>
<h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Character</span> &#123;</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	WeaponBehavior* weapon;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">fight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		weapon-&gt;useWeapon();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setWeapon</span><span class="params">(WeaponBehavior* w)</span> </span>&#123;</span><br><span class="line">		weapon = w;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">King</span> :</span> <span class="keyword">public</span> Character &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	King() &#123;</span><br><span class="line">		weapon = <span class="keyword">new</span> SwordBehavior();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Queen</span> :</span> <span class="keyword">public</span> Character &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	Queen() &#123;</span><br><span class="line">		weapon = <span class="keyword">new</span> BowAndArrowBehavior();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Knight</span> :</span> <span class="keyword">public</span> Character &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	Knight() &#123;</span><br><span class="line">		weapon = <span class="keyword">new</span> AxeBehavior();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Troll</span> :</span> <span class="keyword">public</span> Character &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	Troll() &#123;</span><br><span class="line">		weapon = <span class="keyword">new</span> KnifeBehavior();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">//攻击行为</span></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeaponBehavior</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">useWeapon</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SwordBehavior</span> :</span> <span class="keyword">public</span> WeaponBehavior &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">useWeapon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"Using sword!!!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BowAndArrowBehavior</span> :</span> <span class="keyword">public</span> WeaponBehavior &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">useWeapon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"Using bow and arrow!!!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AxeBehavior</span> :</span> <span class="keyword">public</span> WeaponBehavior &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">useWeapon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"Using axe!!!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KnifeBehavior</span> :</span> <span class="keyword">public</span> WeaponBehavior &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">useWeapon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"Using knife!!!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h3><p>把客户的行为抽象成一个接口，具体的行为继承这个接口并实现出自己特定的行为，客户不需要和具体的行为打交道，只需要和接口打交道，减少耦合，而且利于扩展，只需要扩展特定行为，不需要对客户代码做改变。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2018/05/07/strategy/" data-id="cjgybwwc7000pq6jxl5wpwaud" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-effective4" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/04/15/effective4/">读书笔记 Effective C++(4)</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/04/15/effective4/">
            <time datetime="2018-04-15T13:06:19.000Z" itemprop="datePublished">2018-04-15</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/C/">C++</a>, <a class="tag-link" href="/tags/读书笔记/">读书笔记</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="41、了解隐式接口和编译期多态"><a href="#41、了解隐式接口和编译期多态" class="headerlink" title="41、了解隐式接口和编译期多态"></a>41、了解隐式接口和编译期多态</h2><p>类和模板都支持接口和多态，对类而言，接口是显式的，以函数签名为中心，多态通过虚函数发生于运行期。</p>
<p>对模板参数而言，接口是隐式的，基于有效的表达式，多态通过模板具现化和函数重载解析发生于编译期。</p>
<h2 id="42、了解typename的双重意义"><a href="#42、了解typename的双重意义" class="headerlink" title="42、了解typename的双重意义"></a>42、了解typename的双重意义</h2><p>作为模板参数，class和typename没有不同，可以互换。</p>
<p>当使用一个内嵌类型时，需要在前面加上typename，编译器才知道它是一个类型而不是成员或者函数。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Sample</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line">	<span class="keyword">typename</span> <span class="built_in">std</span>::iterator_traits&lt;T&gt;::<span class="function">value_type <span class="title">temp</span><span class="params">(T)</span></span>;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="43、学习处理模板化基类内的名称"><a href="#43、学习处理模板化基类内的名称" class="headerlink" title="43、学习处理模板化基类内的名称"></a>43、学习处理模板化基类内的名称</h2><p>因为基类模板可能被特化不提供基类模板的某个函数，所以在派生类里面直接调用模板基类的函数无法通过编译，可以通过this指针和using声明或者基类作用域符号来告诉编译器假定该函数存在。</p>
<h2 id="44、将与参数无关的代码抽离templates"><a href="#44、将与参数无关的代码抽离templates" class="headerlink" title="44、将与参数无关的代码抽离templates"></a>44、将与参数无关的代码抽离templates</h2><p>模板生成多个类和函数，所以任何模板都不该与某个造成膨胀的模板参数产生相依关系。</p>
<p>用函数参数或者class成员变量代替模板参数可以消除这种膨胀。</p>
<p>还可以让具有完全相同的二进制表述的类型共享实现码，也可以减小膨胀，如int和long在一些机器上是一样的，所有指针类型都是一样的。</p>
<h2 id="45、运用成员函数模板接受所有兼容类型"><a href="#45、运用成员函数模板接受所有兼容类型" class="headerlink" title="45、运用成员函数模板接受所有兼容类型"></a>45、运用成员函数模板接受所有兼容类型</h2><p>泛化构造函数可以使一个类型隐式转换成另一个类型：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">shared_ptr</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">Y</span>&gt;</span></span><br><span class="line"><span class="class">	<span class="title">shared_ptr</span>(<span class="title">shared_ptr</span>&lt;Y&gt; <span class="title">const</span>&amp;);</span> <span class="comment">//泛化构造函数</span></span><br><span class="line"></span><br><span class="line">	templa&lt;<span class="class"><span class="keyword">class</span> <span class="title">Y</span>&gt;</span></span><br><span class="line"><span class="class">	<span class="title">shared_ptr</span>&amp; <span class="title">operator</span>=(<span class="title">shared_ptr</span>&lt;Y&gt; <span class="title">const</span>&amp;);</span> <span class="comment">//泛化赋值函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>声明了泛化构造函数还是需要声明正常的构造函数和赋值函数。</p>
<h2 id="46、需要类型转换时请为模板定义非成员函数"><a href="#46、需要类型转换时请为模板定义非成员函数" class="headerlink" title="46、需要类型转换时请为模板定义非成员函数"></a>46、需要类型转换时请为模板定义非成员函数</h2><p>当提供与模板相关的包含参数隐式转换的函数时，将函数定义为friend并在类内实现。</p>
<h2 id="47、请使用traits-classes表现类型信息"><a href="#47、请使用traits-classes表现类型信息" class="headerlink" title="47、请使用traits classes表现类型信息"></a>47、请使用traits classes表现类型信息</h2><p>traits classes，特性萃取，使得类型相关信息在编译期可用，以template内嵌typedef和偏特化实现。</p>
<p>如何使用traits？</p>
<ul>
<li>建立一组重载函数，最后一个参数是traits的类型参数，对于不同的类型做实现。</li>
<li>另外建立一个控制函数调用上述函数，传入traits的参数，此为双层结构，在STL中非常常见。</li>
</ul>
<h2 id="48、认识模板元编程（TMP）"><a href="#48、认识模板元编程（TMP）" class="headerlink" title="48、认识模板元编程（TMP）"></a>48、认识模板元编程（TMP）</h2><p>TMP可以将工作从运行期搬到编译期，从而实现更早的错误侦测和更高的执行效率。还可以被用来生成“基于政策选择组合”的客户定制代码，也可以用来避免生成对某些特殊类型并不合适的代码。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">unsigned</span> n&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Factorial</span>&#123;</span></span><br><span class="line">	<span class="keyword">enum</span>&#123;value = n * Factorial&lt;n<span class="number">-1</span>&gt;::value&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Factorial</span>&lt;0&gt;&#123;</span></span><br><span class="line">	<span class="keyword">enum</span>&#123;value = <span class="number">1</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="49、定制new和delete"><a href="#49、定制new和delete" class="headerlink" title="49、定制new和delete"></a>49、定制new和delete</h2><p>set_new_handler允许客户制定一个函数，当内存分配失败时调用这个函数进行处理。</p>
<p>Nothrow new只适用于内存分配，如果构造函数出现问题还是可能抛出异常。</p>
<h2 id="50、了解new和delete的合理替换时机"><a href="#50、了解new和delete的合理替换时机" class="headerlink" title="50、了解new和delete的合理替换时机"></a>50、了解new和delete的合理替换时机</h2><p>有许多理由需要写个自定义的new和delete，包括改善性能、对heap运用错误进行调试、收集heap调试信息等。</p>
<h2 id="51、编写new和delete时需固守常规"><a href="#51、编写new和delete时需固守常规" class="headerlink" title="51、编写new和delete时需固守常规"></a>51、编写new和delete时需固守常规</h2><p>operator new应该内含一个无穷循环，并在其中尝试分配内存，如果它无法满足内存要求，就该调用new_handler。它也应该有能力处理0bytes申请，class专属版本还应该处理“比正确大小更大的申请”。</p>
<p>operator delete应该在收到null指针时不做任何事情，class专属版本还应该处理“比正确大小更大的申请”。</p>
<h2 id="52、写了placement-new也要写placement-delete"><a href="#52、写了placement-new也要写placement-delete" class="headerlink" title="52、写了placement new也要写placement delete"></a>52、写了placement new也要写placement delete</h2><p>placement new只有placement delete能够delete，所以没有声明placement delete使用placement new的话会出现内存泄漏。</p>
<p>当在类内声明placement new和placement delete时会遮盖标准的new和delete，一种做法是将所有标准的new/delete放到一个基类里，然后要自定义new/delete的类继承这个基类，使用using声明获取标准形式。</p>
<h2 id="53、不要轻忽编译器的警告"><a href="#53、不要轻忽编译器的警告" class="headerlink" title="53、不要轻忽编译器的警告"></a>53、不要轻忽编译器的警告</h2><h2 id="54、让自己熟悉包括TR1在内的标准程序库"><a href="#54、让自己熟悉包括TR1在内的标准程序库" class="headerlink" title="54、让自己熟悉包括TR1在内的标准程序库"></a>54、让自己熟悉包括TR1在内的标准程序库</h2><p>C++标准库的主要机能由STL、iostream、locales组成，并包含C99标准程序库。</p>
<p>TR1添加了智能指针、一般化函数指针（function）、hash-based容器、正则表达式以及另外10个组件的支持。</p>
<p>TR1自身只是一个规范，为获得TR1提供的好处，需要一个实物，一个好的来源是Boost。</p>
<h2 id="55、让自己熟悉Boost"><a href="#55、让自己熟悉Boost" class="headerlink" title="55、让自己熟悉Boost"></a>55、让自己熟悉Boost</h2><p>Boost是一个社群，致力于免费、源码开放、同僚复审的C++程序库开发。Boost在C++标准化过程中扮演深具影响力的角色。<br>Boost提供了许多TR1组件实现品，以及其他许多程序库。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2018/04/15/effective4/" data-id="cjgybwwf8002aq6jxw42naecy" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-effective3" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/04/07/effective3/">读书笔记 Effective C++(3)</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/04/07/effective3/">
            <time datetime="2018-04-07T12:34:53.000Z" itemprop="datePublished">2018-04-07</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/C/">C++</a>, <a class="tag-link" href="/tags/读书笔记/">读书笔记</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="26、尽可能延后变量定义式的出现时间"><a href="#26、尽可能延后变量定义式的出现时间" class="headerlink" title="26、尽可能延后变量定义式的出现时间"></a>26、尽可能延后变量定义式的出现时间</h2><p>这样做可以增加程序的清晰度并改善程序效率。如果程序异常提前退出而变量定义在前，则该变量不会被使用但是还是付出了构造和析构的成本，因此将变量定义延后直到使用变量之前，甚至延后到能给予初值之前，这样可以避免无意义的default构造函数。</p>
<h2 id="27、尽量少做转型动作"><a href="#27、尽量少做转型动作" class="headerlink" title="27、尽量少做转型动作"></a>27、尽量少做转型动作</h2><p>尽量避免转型，特别是避免dynamic_cast，其运行速度很慢，如果某个设计需要转型动作，试着找一些替代做法，如virtual函数，如果转型是必要的，将其隐藏于某个函数里。<br>使用C++新式转型不要用旧式转型，前者很容易识别出来。</p>
<h2 id="28、避免返回handles指向对象内部成分"><a href="#28、避免返回handles指向对象内部成分" class="headerlink" title="28、避免返回handles指向对象内部成分"></a>28、避免返回handles指向对象内部成分</h2><p>避免返回handles（指针，引用，迭代器）指向对象内部，一是提升封装性，如果指向private成员，则用户可以修改这些成员，private就没用了，二是帮助const成员函数的行为像一个const，并降低空悬的可能性。</p>
<h2 id="29、为异常安全努力是值得的"><a href="#29、为异常安全努力是值得的" class="headerlink" title="29、为异常安全努力是值得的"></a>29、为异常安全努力是值得的</h2><p>异常安全函数即使发生异常也不会泄漏资源或允许任何数据结构被破坏，这样的函数分为3种可能，基本型（若异常被抛出，程序内任何事物仍然处于有效状态下，有可能发生改变）、强烈型（要么全变，要么不变）、不抛异常型。</p>
<p>强烈保证往往能够以copy and swap实现出来，但不一定对所有函数都有实现意义，例如copy的成本太高。</p>
<p>一个函数提供的异常安全性最高是它所调用的各个函数的安全性的最弱的一个。</p>
<h2 id="30、透彻了解inlining的里里外外"><a href="#30、透彻了解inlining的里里外外" class="headerlink" title="30、透彻了解inlining的里里外外"></a>30、透彻了解inlining的里里外外</h2><ul>
<li>inline将每一处调用函数的地方都用函数本体替换，提升运行速度但会导致代码膨胀，因此inline函数适合体积小、调用频繁的函数</li>
<li>在类内部定义的函数默认是inline的</li>
<li>inline只是一种申请，实际上到底实施inline还要取决于编译器的决定</li>
<li>因为inline是编译时决定，而virtual是运行时决定，所以对一个virtual函数inline没有意义。</li>
<li>如果需要对inline的函数取地址，编译器往往会生成一个no-inline的函数，当用函数指针调用这个函数时，使用的是非inline的版本。</li>
<li>inline函数往往不利于调试，无法设置断点</li>
</ul>
<h2 id="31、将文件间的编译依存关系降至最低"><a href="#31、将文件间的编译依存关系降至最低" class="headerlink" title="31、将文件间的编译依存关系降至最低"></a>31、将文件间的编译依存关系降至最低</h2><p>支持“编译依存性最小化”的一般构想是：相依于声明式，不要相依于定义式，两个手段是Handle class（pimpl）和Interface class（抽象类）。</p>
<p>程序库头文件应该以“完全且仅有声明式”的形式存在，这种做法不论是否涉及templates都适用。</p>
<h2 id="32、确定你的public继承塑模出is-a关系"><a href="#32、确定你的public继承塑模出is-a关系" class="headerlink" title="32、确定你的public继承塑模出is-a关系"></a>32、确定你的public继承塑模出is-a关系</h2><p>public继承意味着is-a，对基类适用的所有操作对派生类也适用，因为每个派生类对象也是一个基类对象。</p>
<h2 id="33、避免遮掩继承而来的名称"><a href="#33、避免遮掩继承而来的名称" class="headerlink" title="33、避免遮掩继承而来的名称"></a>33、避免遮掩继承而来的名称</h2><p>派生类内的名称会遮掩基类内的名称，可以适用using声明来让基类的名称可见，或者使用转交函数，转交函数显式调用基类的函数。</p>
<h2 id="34、区分接口继承和实现继承"><a href="#34、区分接口继承和实现继承" class="headerlink" title="34、区分接口继承和实现继承"></a>34、区分接口继承和实现继承</h2><p>接口继承和实现继承不同，在public继承下，派生类总是继承基类的接口。</p>
<p>纯虚函数只具体指定接口继承，派生类必须自己实现。</p>
<p>虚函数指定接口继承和缺省实现继承，派生类可以选择实现，可以用纯虚函数来实现，基类的纯虚函数定义缺省行为，在派生类的虚函数实现中显式调用基类的纯虚函数。</p>
<p>非虚函数实现接口继承和强制性实现继承，派生类不应该重新定义。</p>
<h2 id="35、考虑virtual函数以外的其他选择"><a href="#35、考虑virtual函数以外的其他选择" class="headerlink" title="35、考虑virtual函数以外的其他选择"></a>35、考虑virtual函数以外的其他选择</h2><p>虚函数的替代方案，第一个是NVI（Non-Virtual Interface）手法，是一种Template Method设计模式，定义一个非虚的public函数调用private的虚函数，这个非虚函数成为外覆器，这么做的好处是在虚函数调用前后，还可以做其他的处理，如互斥锁上锁，制造日志等，只用virtual函数无法做到这些。</p>
<p>第二个是所谓的Strategy模式，用函数指针代替虚函数，创建对象时传递相应的函数指针，这样的好处是对于同一类型可以有不同的表现方法，传递的函数不同表现则不同，有更大的弹性，若对象的表现在运行期会改变，也可以提供一个setMethod函数方便地进行改变，但是这样的函数若需要访问类的私有成员就不得不声明为友元，降低了类的封装性。<br>还可以用function来实现Strategy模式，function可以保存的是所有可以调用的对象，包括函数指针，仿函数，成员函数等，而且也允许兼容，例如返回类型或者参数类型可以隐式转换成所需的类型，这样的函数也可以放进function里面。<br>一种古典的Strategy模式是将体系内的virtual函数替换为另一个继承体系中的virtual函数。</p>
<h2 id="36、绝不重新定义继承而来的non-virtual函数"><a href="#36、绝不重新定义继承而来的non-virtual函数" class="headerlink" title="36、绝不重新定义继承而来的non-virtual函数"></a>36、绝不重新定义继承而来的non-virtual函数</h2><p>由于静态绑定的原因，当用基类指针调用non-virtual函数时永远是调用基类的，因此不要重新定义继承来的non-virtual函数。</p>
<h2 id="37、绝不重新定义继承而来的缺省参数值"><a href="#37、绝不重新定义继承而来的缺省参数值" class="headerlink" title="37、绝不重新定义继承而来的缺省参数值"></a>37、绝不重新定义继承而来的缺省参数值</h2><p>缺省参数值是静态绑定，而虚函数是动态绑定，当缺省参数不同时，基类指针只会调用基类的缺省参数不会用派生类的。</p>
<h2 id="38、通过复合塑模出has-a或者“根据某物实现出”"><a href="#38、通过复合塑模出has-a或者“根据某物实现出”" class="headerlink" title="38、通过复合塑模出has-a或者“根据某物实现出”"></a>38、通过复合塑模出has-a或者“根据某物实现出”</h2><p>public继承是is-a，而在类里定义另一个类的对象则是has-a或者is-implemented-in-terms-of a（由a实现出）。</p>
<h2 id="39、明智而审慎地使用private继承"><a href="#39、明智而审慎地使用private继承" class="headerlink" title="39、明智而审慎地使用private继承"></a>39、明智而审慎地使用private继承</h2><p>private继承是一种is-implemented-in-terms-of，private继承的派生类对象不会被转为基类对象，类似于复合，根据某物实现出，<strong>尽可能使用复合</strong>而不是private继承，当需要访问protected成员和virtual函数时，使用private继承。</p>
<p>private继承可以利用empty base最优化：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Empty</span>&#123;</span>&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HoldInt</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">int</span> x;</span><br><span class="line">	Empty e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面这个复合的例子，空的类的size并不是0，编译器往往会放入一个char，size往往是1，因此HoldInt的size加上对齐达到了8，而使用private继承就不会有这种问题：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Empty</span>&#123;</span>&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HoldInt</span> :</span> <span class="keyword">private</span> Empty&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">int</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这时HoldInt的size就为一个int的大小。</p>
<h2 id="40、明智而审慎地使用多重继承"><a href="#40、明智而审慎地使用多重继承" class="headerlink" title="40、明智而审慎地使用多重继承"></a>40、明智而审慎地使用多重继承</h2><p>多重继承比单继承复杂，可能导致二义性，即两个基类中有同名函数，不知道该调用哪一个，此外如果一个基类在继承路径上出现多次还可能需要虚继承。</p>
<p>虚继承会增加大小、速度、初始化复杂度等成本，如果虚基类不带任何数据是最具有实用性的情况。</p>
<p>多重继承的一个用途是，其中一个以public继承某个interface，另一个以private继承某个实现。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2018/04/07/effective3/" data-id="cjgybwwb30007q6jxr27d2ea8" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-effectiveC-2" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/04/06/effectiveC-2/">读书笔记 Effective C++(2)</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/04/06/effectiveC-2/">
            <time datetime="2018-04-07T03:16:59.000Z" itemprop="datePublished">2018-04-06</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/C/">C++</a>, <a class="tag-link" href="/tags/读书笔记/">读书笔记</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="13、以对象管理资源"><a href="#13、以对象管理资源" class="headerlink" title="13、以对象管理资源"></a>13、以对象管理资源</h2><p>将动态分配的资源放进一个资源管理类中，构造函数中获得资源（RAII），析构函数保证了这些资源的释放。<br>常用的有shared_ptr和auto_ptr，前者常用，后者复制时会把被复制的指针置为null，一块内存只能有一个auto_ptr指向它。</p>
<h2 id="14、在资源类中小心copying行为"><a href="#14、在资源类中小心copying行为" class="headerlink" title="14、在资源类中小心copying行为"></a>14、在资源类中小心copying行为</h2><p>考虑下面这么一个管理互斥锁的类：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lock</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	explicit Lock(Mutex* pm): mutexPtr(pm)&#123;</span><br><span class="line">		lock(mutexPtr);<span class="comment">//获得资源</span></span><br><span class="line">	&#125;</span><br><span class="line">	~Lock()&#123;</span><br><span class="line">		unlock(mutexPtr);<span class="comment">//释放资源</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当Lock类复制时，大多数时候可以有两种选择，第一个是禁止复制：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lock</span>： <span class="title">private</span> <span class="title">Uncopyable</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第二种是用引用计数法来管理复制，复制时，引用加1，当引用为0时，释放资源，使用shared_ptr还可以定制自己的删除器，因为有时候并不希望释放资源，像Lock，析构的时候不释放资源，只是解锁。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lock</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	explicit Lock(Mutex* pm): mutexPtr(pm, unlock)//指定删除器unlock</span><br><span class="line">	&#123;</span><br><span class="line">		lock(mutexPtr.get());</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="built_in">shared_ptr</span>&lt;Mutex&gt; mutexPtr;<span class="comment">//不再需要析构函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="15、在资源管理类中提供对原始资源的访问"><a href="#15、在资源管理类中提供对原始资源的访问" class="headerlink" title="15、在资源管理类中提供对原始资源的访问"></a>15、在资源管理类中提供对原始资源的访问</h2><p>有些API需要对原始资源进行访问而不是资源管理类，故资源管理类应该提供办法对原始资源进行访问。<br>有显示转换和隐式转换两种办法。显示转换专门定义一个返回原始资源的函数，例如shared_ptr提供get函数返回原始指针。<br>隐式转换则是直接将资源管理类转换成原始资源类型，如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Font</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	...</span><br><span class="line">	<span class="comment">//隐式转换，Font转换为FontHandle</span></span><br><span class="line">	<span class="function"><span class="keyword">operator</span> <span class="title">FontHandle</span><span class="params">()</span> <span class="keyword">const</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> f;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	FontHandle f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>隐式转换对用户来说很方便，但可能会产生一些问题，显示转换比较安全。</p>
<h2 id="16、成对使用new和delete时要采取相同形式"><a href="#16、成对使用new和delete时要采取相同形式" class="headerlink" title="16、成对使用new和delete时要采取相同形式"></a>16、成对使用new和delete时要采取相同形式</h2><p>new和delete搭配，new[]和delete[]搭配，最好不要对数组做typedef。</p>
<h2 id="17、以独立语句将newed对象置入智能指针"><a href="#17、以独立语句将newed对象置入智能指针" class="headerlink" title="17、以独立语句将newed对象置入智能指针"></a>17、以独立语句将newed对象置入智能指针</h2><p>以单独一条语句将new出来的对象放到智能指针中去。如果不这么做，一旦有异常抛出，可能会导致难以察觉的资源泄漏。</p>
<h2 id="18、让接口容易被正确使用，不易被误用"><a href="#18、让接口容易被正确使用，不易被误用" class="headerlink" title="18、让接口容易被正确使用，不易被误用"></a>18、让接口容易被正确使用，不易被误用</h2><p>让接口正确使用的方法包括接口的一致性，与内置类型的行为兼容。<br>阻止误用的方法包括建立新类型、限制类型上的操作，束缚对象值，以及消除客户的资源管理责任。<br>shared_ptr支持定制删除器，可以防范DLL问题（即在一个DLL里创建在另一个DLL里释放），可以用来包装互斥锁，实现自动解锁。</p>
<h2 id="19、设计class犹如设计type"><a href="#19、设计class犹如设计type" class="headerlink" title="19、设计class犹如设计type"></a>19、设计class犹如设计type</h2><p>设计class就是设计一个新type，要考虑方方面面的问题。</p>
<h2 id="20、宁可以pass-by-reference-to-const替换pass-by-value"><a href="#20、宁可以pass-by-reference-to-const替换pass-by-value" class="headerlink" title="20、宁可以pass by reference to const替换pass by value"></a>20、宁可以pass by reference to const替换pass by value</h2><p>对一个类对象传值意味着复制，会调用拷贝构造函数和析构函数，造成了不必要的时间消耗，而传引用则不会调用拷贝构造函数，更高效，如果函数对传入的参数不进行改变，应该加上const。<br>对于内置类型和STL的迭代器和函数对象，传值比较适合。</p>
<h2 id="21、必须返回对象时，别妄想返回其reference"><a href="#21、必须返回对象时，别妄想返回其reference" class="headerlink" title="21、必须返回对象时，别妄想返回其reference"></a>21、必须返回对象时，别妄想返回其reference</h2><p>不要返回对一个局部对象的引用，在函数结束后该对象被释放，引用变成不合法的。<br>同样不要在函数内返回一个newed对象的引用，因为delete得不到保障。<br>也不要返回对一个static对象的引用，如果同时需要多个这样的对象，会出问题。<br>指针同理。</p>
<h2 id="22、将成员变量声明为private"><a href="#22、将成员变量声明为private" class="headerlink" title="22、将成员变量声明为private"></a>22、将成员变量声明为private</h2><p>为了封装性，将成员变量声明为private，这可以赋予客户端访问数据的一致性、可以细微划分成员的访问控制（可读可写）、允许约束条件获得保证，并提供class作者充分的实现弹性。<br>protect的封装性不比public好，因为派生类可以访问protect成员。</p>
<h2 id="23、宁以non-member、non-friend替换member函数"><a href="#23、宁以non-member、non-friend替换member函数" class="headerlink" title="23、宁以non-member、non-friend替换member函数"></a>23、宁以non-member、non-friend替换member函数</h2><p>这样做可以增加封装性、包裹弹性和机能扩充性。</p>
<h2 id="24、若所有参数皆需要类型转换，请为此采用non-member函数"><a href="#24、若所有参数皆需要类型转换，请为此采用non-member函数" class="headerlink" title="24、若所有参数皆需要类型转换，请为此采用non-member函数"></a>24、若所有参数皆需要类型转换，请为此采用non-member函数</h2><p>如果一个函数需要对所有参数进行类型转换，它必须是non-member的，因此调用端不能进行类型转换。如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rational</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	Rational(<span class="keyword">int</span> numerator = <span class="number">0</span>, <span class="keyword">int</span> denominator = <span class="number">1</span>); <span class="comment">//无explicit，允许隐式转换</span></span><br><span class="line">	<span class="keyword">const</span> Rational <span class="keyword">operator</span>*(<span class="keyword">const</span> Rational&amp; rhs) <span class="keyword">const</span>;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line">Rational onehalf = Rational(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">Rational result;</span><br><span class="line">result = onehalf * <span class="number">2</span>;  <span class="comment">//正确，2进行了隐式转换</span></span><br><span class="line">result = <span class="number">2</span> * onehalf; <span class="comment">//错误，相当于2.operator*(onehalf),2不是Rational类型！</span></span><br></pre></td></tr></table></figure></p>
<p>解决方法就是将该函数声明为non-meber的：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Rational <span class="keyword">operator</span>*(<span class="keyword">const</span> Rational&amp; lhs, <span class="keyword">const</span> Rational&amp; rhs) <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line">Rational onehalf = Rational(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">Rational result;</span><br><span class="line">result = onehalf * <span class="number">2</span>;  <span class="comment">//正确，2进行了隐式转换</span></span><br><span class="line">result = <span class="number">2</span> * onehalf;  <span class="comment">//正确！</span></span><br></pre></td></tr></table></figure></p>
<h2 id="25、考虑写一个不抛出异常的swap函数"><a href="#25、考虑写一个不抛出异常的swap函数" class="headerlink" title="25、考虑写一个不抛出异常的swap函数"></a>25、考虑写一个不抛出异常的swap函数</h2><p>当std的swap对一个类型效率不高时，提供一个swap成员函数，且这个成员函数不应该抛出异常，往往这个类承担一种指针的角色，指向真正的实现类（pimpl），swap只需要互换指针而不需要互换数据。<br>如果提供一个成员函数，也该提供一个非成员函数来调用成员函数，对于class，也请特化std的swap。<br>调用swap时先声明using std::swap然后再调用，且调用不包含任何的命名空间的修饰。<br>不要在std里加入新东西。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> WidgetStuff&#123;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Widget</span>&#123;</span></span><br><span class="line">	<span class="keyword">private</span>:</span><br><span class="line">		WidgetImpl* pImpl;</span><br><span class="line">	<span class="keyword">public</span>:</span><br><span class="line">		...</span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(Widget&amp; other)</span></span>&#123;</span><br><span class="line">			<span class="keyword">using</span> <span class="built_in">std</span>::swap;</span><br><span class="line">			swap(pImpl, other.pImpl);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(Widget&amp; a, Widget&amp; b)</span></span>&#123;</span><br><span class="line">		a.swap(b);<span class="comment">//调用成员函数</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2018/04/06/effectiveC-2/" data-id="cjgybwwck000wq6jxxilpfqkq" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-读书笔记-Effective-C" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/04/06/读书笔记-Effective-C/">读书笔记 Effective C++</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/04/06/读书笔记-Effective-C/">
            <time datetime="2018-04-06T08:56:42.000Z" itemprop="datePublished">2018-04-06</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/C/">C++</a>, <a class="tag-link" href="/tags/读书笔记/">读书笔记</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>共有55个法则。</p>
<h2 id="1、视C-为一个语言联邦"><a href="#1、视C-为一个语言联邦" class="headerlink" title="1、视C++为一个语言联邦"></a>1、视C++为一个语言联邦</h2><p>C++包含多个次语言：</p>
<ul>
<li>C</li>
<li>面向对象</li>
<li>模板</li>
<li>STL</li>
</ul>
<p>每个次语言都有自己不同的规范。</p>
<h2 id="2、尽量用const，enum，inline代替-define"><a href="#2、尽量用const，enum，inline代替-define" class="headerlink" title="2、尽量用const，enum，inline代替#define"></a>2、尽量用const，enum，inline代替#define</h2><p>#define宏定义直接被替换掉，因此像<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NUM 123</span></span><br></pre></td></tr></table></figure></p>
<p>当程序获得一个编译错误时，不会出现NUM，因为NUM已经被123替换掉了，可能存在多个123，因此就无从得知123对应的是什么意思，用const就不会有这种问题。此外const还可以定义类内的专属常量，比如：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GamePlayer</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> NumTurns = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">int</span> scores[NumTurns];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用enum hack也可以做到这一点：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GamePlayer</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">enum</span> &#123; NumTurns = <span class="number">5</span> &#125;;</span><br><span class="line">    <span class="keyword">int</span> scores[NumTurns];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>enum中的数值可以当作int来使用。<br>这种常量是类内专用的，如果用#define就做不到这一点，因为#define的值是作用到全局的。enum hack的行为更像#define，它们都不能取地址，而const可以取地址。</p>
<p>对于函数形式的宏，会导致各种各样的问题，最好用inline函数代替。</p>
<h2 id="3、尽可能使用const"><a href="#3、尽可能使用const" class="headerlink" title="3、尽可能使用const"></a>3、尽可能使用const</h2><p>const修饰的对象不能被改变，编译器会强制实行这个约束。</p>
<p>const作用于类的成员函数时，不能对成员变量进行修改，但是通过使用mutable关键字的成员变量可以在const成员函数里被改变。</p>
<p>当const成员函数和non-const成员函数的实现等价时，可以让non-const函数调用const版本避免代码重复，方法是用const_cast去除const属性。如下例：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextBlock</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>&amp; <span class="keyword">operator</span>[](<span class="built_in">std</span>::<span class="keyword">size_t</span> position) <span class="keyword">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line">        ...</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> text[position];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">char</span>&amp; <span class="keyword">operator</span>[](<span class="built_in">std</span>::<span class="keyword">size_t</span> position)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">const_cast</span>&lt;<span class="keyword">char</span>&amp;&gt;(                         <span class="comment">//去除const属性</span></span><br><span class="line">                <span class="keyword">static_cast</span>&lt;<span class="keyword">const</span> TextBlock&amp;&gt;(*<span class="keyword">this</span>)      <span class="comment">//将*this转为const调用const版本的[]</span></span><br><span class="line">                [position]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="4、确定对象被使用前已先被初始化"><a href="#4、确定对象被使用前已先被初始化" class="headerlink" title="4、确定对象被使用前已先被初始化"></a>4、确定对象被使用前已先被初始化</h2><p>对于内置类型如int、double等，必须手工完成初始化，C++不保证初始化他们。</p>
<p>对于类类型，构造函数必须保证初始化所有的成员，最好的方式是使用初始化列表而不是在函数体内赋值，初始化列表使用对应参数直接进行拷贝构造，而函数体内赋值则是先经过默认构造函数构造然后再进行赋值，效率较低，且const，引用和没有默认构造函数的类成员只能在初始化列表中进行初始化。</p>
<p>对于位于多个不同文件中的static对象，为了避免初始化次序带来的问题，如A的初始化依赖于B，而B不保证在A初始化之前进行初始化，可以将static对象放到一个函数里，在函数里声明局部的static对象，返回这个对象的引用，将直接使用static对象改为调用函数来使用static对象，这样就保证static对象在使用时一定已经经过了初始化。如下是一个例子：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileSystem</span>&#123;</span>...&#125;；</span><br><span class="line"><span class="function">FileSystem&amp; <span class="title">tfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> FileSystem fs;</span><br><span class="line">    <span class="keyword">return</span> fs;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Directory</span>&#123;</span>...&#125;;</span><br><span class="line">Directory::Directory(params)&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">std</span>::<span class="keyword">size_t</span> disks = tfs().numDisks();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Directory&amp; <span class="title">tempDir</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Directory td;</span><br><span class="line">    <span class="keyword">return</span> td;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>tfs()函数保证fs对象在使用前已经进行了初始化。</p>
<h2 id="5、了解C-默默编写并调用哪些函数"><a href="#5、了解C-默默编写并调用哪些函数" class="headerlink" title="5、了解C++默默编写并调用哪些函数"></a>5、了解C++默默编写并调用哪些函数</h2><p>编译器会自动为class创建默认构造函数、拷贝构造函数、赋值操作符、析构函数。只要用户自己声明了一个构造函数，编译器就不会自动创建默认构造函数。<br>如果类成员包含const或者引用，编译器不会自动合成一个赋值操作符，因为const和引用不能赋值，此时需要自己编写赋值操作符。<br>如果基类的赋值操作符是private的，则编译器也不会为其派生类合成赋值操作符。</p>
<h2 id="6、若不想使用编译器自动生成的函数，就该明确拒绝"><a href="#6、若不想使用编译器自动生成的函数，就该明确拒绝" class="headerlink" title="6、若不想使用编译器自动生成的函数，就该明确拒绝"></a>6、若不想使用编译器自动生成的函数，就该明确拒绝</h2><p>可以将成员函数声明为private的，来阻止编译器的自动合成行为。比如我们不希望一个类进行拷贝或赋值，可以将拷贝构造函数和赋值操作符声明为private，且不给出实现，如此当程序试图拷贝这个类时，编译器会报错，当类的成员函数或友元调用这个函数时，由于没有给出实现，因此连接器会报错。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeForSale</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	...	</span><br><span class="line">	HomeForSale(<span class="keyword">const</span> HomeForSale&amp;);</span><br><span class="line">	HomeForSale&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> HomeForSale&amp;); <span class="comment">//只声明不定义</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第二种方法是设计一个不能拷贝的基类，让其余类派生自这个基类，则这些派生类也就不能拷贝了。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Uncopyable</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">//允许构造和析构</span></span><br><span class="line">	Uncopyable();</span><br><span class="line">	~Uncopyable();</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">//不允许拷贝和赋值</span></span><br><span class="line">	Uncopyable(<span class="keyword">const</span> Uncopyable&amp;);</span><br><span class="line">	Uncopyable&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Uncopyable&amp;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeForSale</span>:</span><span class="keyword">private</span> Uncopyable&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="7、为多态基类声明virtual析构函数"><a href="#7、为多态基类声明virtual析构函数" class="headerlink" title="7、为多态基类声明virtual析构函数"></a>7、为多态基类声明virtual析构函数</h2><p>考虑下面的例子：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimeKeeper</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	TimeKeeper();</span><br><span class="line">	~TimeKeeper();</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AtomicClock</span>:</span><span class="keyword">public</span> TimerKeeper&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line">TimeKeeper* tk = <span class="keyword">new</span> AtomicClock;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">delete</span> tk;</span><br></pre></td></tr></table></figure></p>
<p>创建一个基类的指针指向派生类对象，而该指针释放时，却由基类指针进行释放，而且析构函数不是virtual的，因此只有基类的部分进行了析构，而派生类的部分没有得到析构，因此造成了内存泄漏。将基类的析构函数声明为virtual就可解决这个问题。往往一个基类只要包含了其他的virtual函数，它的析构函数也要是virtual的，virtual函数是用来实现多态的，需要用基类的指针指向派生类对象，因此析构函数必须是virtual。若一个基类没有virtual函数，说明这个基类不是用于多态，就不需要virtual析构函数，因为virtual函数带来了额外的vptr的空间开销，因此若不需要多态就不应该将析构函数声明为virtual的。</p>
<h2 id="8、别让异常逃离析构函数"><a href="#8、别让异常逃离析构函数" class="headerlink" title="8、别让异常逃离析构函数"></a>8、别让异常逃离析构函数</h2><p>只要析构函数抛出异常，程序可能过早结束或者发生不明确的行为。如果某个操作失败时会发生异常，则应该将这个操作移出析构函数放到另外一个函数里面，在析构函数里调用这个函数，此时析构函数应该捕捉任何异常，并且选择吞下它们不进行传播或者结束程序（abort函数）。</p>
<h2 id="9、绝不在构造和析构过程中调用virtual函数"><a href="#9、绝不在构造和析构过程中调用virtual函数" class="headerlink" title="9、绝不在构造和析构过程中调用virtual函数"></a>9、绝不在构造和析构过程中调用virtual函数</h2><p>在构造和析构过程中调用virtual函数往往不会带来预期的结果。在派生类对象构造时，基类部分会先进行构造，如果基类的构造函数里调用了virtual函数，此时派生类部分还未初始化完成，因此这个函数不会下降到派生类去调用派生类里面的virtual函数，此时virtual函数的行为就像一个non-virtual函数一样，只是调用基类的，另一个根本原因是在派生类的基类部分构造期间，对象的类型就是基类而不是派生类，因此不存在多态。析构函数也一样，派生类优先于基类析构，如果此时析构函数调用了virtual函数，因为派生类部分已经被销毁了，调用派生类的virtual函数也是危险的。</p>
<h2 id="10、令operator-返回一个reference-to-this"><a href="#10、令operator-返回一个reference-to-this" class="headerlink" title="10、令operator=返回一个reference to *this"></a>10、令operator=返回一个reference to *this</h2><p>为了实现连锁赋值，operator=应该返回一个指向左侧对象的引用。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Widget</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	...</span><br><span class="line">	Widget&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Widget&amp; rhs)&#123;</span><br><span class="line">		...</span><br><span class="line">		<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="11、在oprator-里处理自我赋值"><a href="#11、在oprator-里处理自我赋值" class="headerlink" title="11、在oprator=里处理自我赋值"></a>11、在oprator=里处理自我赋值</h2><p>由于多个指针或者引用可能指向同一个对象，所以对自我赋值需要特别注意。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Widget</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	Bitmap* pb;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	...</span><br><span class="line">	Widget&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Widget&amp; rhs)&#123;</span><br><span class="line">		<span class="keyword">delete</span> pb;</span><br><span class="line">		pb = <span class="keyword">new</span> Bitmap(*rhs.pb);</span><br><span class="line">		<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>以上的代码未考虑自我赋值情况，如果*this和rhs是同一对象时，第一行的delete就已经将rhs释放掉了。可以加上一个测试以解决自我赋值：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Widget&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Widget&amp; rhs)&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">	<span class="keyword">delete</span> pb;</span><br><span class="line">	pb = <span class="keyword">new</span> Bitmap(*rhs.pb);</span><br><span class="line">	<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>但是上面这个版本不具备异常安全，当new抛出异常时，bp指向的对象已经被释放了，所以返回的是一个指向已经被删除的指针，这种指针非常危险，下面是一个异常安全的做法：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Widget&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Widget&amp; rhs)&#123;</span><br><span class="line">	Bitmap* pOrigin = pb;		<span class="comment">//记住原来的pb</span></span><br><span class="line">	pb = <span class="keyword">new</span> Bitmap(*rhs.pb);	<span class="comment">//构造新的pb</span></span><br><span class="line">	<span class="keyword">delete</span> pOrigin;				<span class="comment">//释放旧的pb</span></span><br><span class="line">	<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>另一个方案是采用swap and copy：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Widget&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Widget&amp; rhs)&#123;</span><br><span class="line">	Widget temp(rhs);	<span class="comment">//copy rhs</span></span><br><span class="line">	swap(temp);			<span class="comment">//swap</span></span><br><span class="line">	<span class="keyword">return</span> *<span class="keyword">this</span>;		</span><br><span class="line">&#125;<span class="comment">//temp对象析构，此时temp指向的原来的pb，被析构掉了</span></span><br></pre></td></tr></table></figure></p>
<h2 id="12、复制对象时勿忘其每一个成分"><a href="#12、复制对象时勿忘其每一个成分" class="headerlink" title="12、复制对象时勿忘其每一个成分"></a>12、复制对象时勿忘其每一个成分</h2><p>拷贝构造函数和赋值函数应该确保对每一个成员进行复制，特别是一个派生类的拷贝构造函数应该调用基类的构造函数来复制基类的部分。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span>&#123;</span>...&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span>:</span><span class="keyword">public</span> Base&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	Derived(<span class="keyword">const</span> Derived&amp; rhs):Base(rhs)&#123;...&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>拷贝构造函数和赋值函数不应该互相调用对方，如果有相同的操作，应该放到第三个函数中，由两个函数调用。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2018/04/06/读书笔记-Effective-C/" data-id="cjgybwwfc002cq6jx62tec5zr" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-编译原理学习笔记（五）代码生成" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/03/17/编译原理学习笔记（五）代码生成/">编译原理学习笔记（五）代码生成</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/03/17/编译原理学习笔记（五）代码生成/">
            <time datetime="2018-03-17T14:04:17.000Z" itemprop="datePublished">2018-03-17</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/编译原理/">编译原理</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h3><p>后端的第一步，对抽象语法树进行处理，生成一个或多个中间代码，最后生成机器能识别的目标代码。<br>有两个重要任务，第一是给源代码的数据分配资源，二是给源代码选择合适的指令。<br>资源有寄存器、数据区、代码区、栈、堆等。寄存器的存取速度最快，但是数量有限。<br>指令有算数运算、比较、跳转、函数调用返回等。不同的机器指令集也不同。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2018/03/17/编译原理学习笔记（五）代码生成/" data-id="cjgybwwdb0019q6jxt7nleg7i" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-编译原理学习笔记（四）语义分析" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2018/03/16/编译原理学习笔记（四）语义分析/">编译原理学习笔记（四）语义分析</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2018/03/16/编译原理学习笔记（四）语义分析/">
            <time datetime="2018-03-17T04:25:54.000Z" itemprop="datePublished">2018-03-16</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/编译原理/">编译原理</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h3 id="语义分析的任务"><a href="#语义分析的任务" class="headerlink" title="语义分析的任务"></a>语义分析的任务</h3><p>对抽象语法树进行分析，检查有无语义错误，上下文相关属性，如变量使用前是否声明，函数参数是否一致等。<br>需要两个输入，一个是语法树，一个是程序语言的语义。输出为中间代码。</p>
<h3 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h3><p>通过类型检查算法和符号表来实现检查。<br>类型检查算法用来检查每个表达式或语句的类型是什么，是否符合规范。</p>
<h3 id="符号表"><a href="#符号表" class="headerlink" title="符号表"></a>符号表</h3><p>用来存储程序中各个变量的相关信息，如类型，作用域，访问控制信息，是一种key-value结构。<br>节省时间，可以用哈希表，节省空间，可以用红黑树。<br>符号表处理作用域的方法：一是用一张表，进入作用域就插入元素，离开作用域就删除元素，二是用多张表，构成一个栈，进入作用域就插入一张新表，离开就删除栈顶的表。<br>符号表处理名字空间的方法：引入标签，标号来区别不同类型。</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2018/03/16/编译原理学习笔记（四）语义分析/" data-id="cjgybwwdf001bq6jxysn3xgo4" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">下一页 &raquo;</a>
    </nav>
</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/05/08/mvc/" class="title">设计模式之复合模式</a></p>
                            <p class="item-date"><time datetime="2018-05-08T23:51:05.000Z" itemprop="datePublished">2018-05-08</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/05/08/agen/" class="title">设计模式之代理模式</a></p>
                            <p class="item-date"><time datetime="2018-05-08T23:50:32.000Z" itemprop="datePublished">2018-05-08</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/05/08/state/" class="title">设计模式之状态模式</a></p>
                            <p class="item-date"><time datetime="2018-05-08T23:49:52.000Z" itemprop="datePublished">2018-05-08</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/05/08/composite/" class="title">设计模式之组合模式</a></p>
                            <p class="item-date"><time datetime="2018-05-08T23:49:10.000Z" itemprop="datePublished">2018-05-08</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/05/08/iterator/" class="title">设计模式之迭代器模式</a></p>
                            <p class="item-date"><time datetime="2018-05-08T23:48:31.000Z" itemprop="datePublished">2018-05-08</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">3</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C++</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/博客/">博客</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编译原理/">编译原理</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络编程/">网络编程</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书笔记/">读书笔记</a><span class="tag-list-count">18</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2018 sapphireHL<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        


    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>